{% extends "coresite/base.html" %}
{% load jsonld seo_tags %}

{% block meta %}
  {% if page_number > 1 %}
    {% with pn=page_number|stringformat:"s" %}
      {% with page_title=page_title|add:" — Page "|add:pn meta_description="Latest news and insights from Technofatty. Page "|add:pn %}
        {% include "coresite/partials/seo/meta_head.html" %}
      {% endwith %}
    {% endwith %}
  {% else %}
    {% with meta_description="Latest news and insights from Technofatty." %}
      {% include "coresite/partials/seo/meta_head.html" %}
    {% endwith %}
  {% endif %}
  {% if prev_page_url %}<link rel="prev" href="{{ prev_page_url }}">{% endif %}
  {% if next_page_url %}<link rel="next" href="{{ next_page_url }}">{% endif %}
{% endblock %}

{% block structured_data %}
  {{ block.super }}
  {% canonical_url canonical_url as resolved_canonical %}
  {% jsonld %}
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "CollectionPage",
      "@id": "{{ resolved_canonical }}#webpage",
      "url": "{{ resolved_canonical }}",
      "name": "{{ page_title|escapejs }}",
      "isPartOf": {
        "@type": "WebSite",
        "@id": "https://technofatty.com/#website"
      },
      "inLanguage": "en"
    },
    {
      "@type": "BreadcrumbList",
      "@id": "{{ resolved_canonical }}#breadcrumb",
      "itemListElement": [
        {"@type": "ListItem", "position": 1, "name": "Home", "item": "https://technofatty.com/"},
        {"@type": "ListItem", "position": 2, "name": "{{ page_title|escapejs }}", "item": "{{ resolved_canonical }}"}
      ]
    },
    {
      "@type": "ItemList",
      "@id": "{{ resolved_canonical }}#list",
      "itemListElement": [
        {% for post in page_posts %}{"@type": "ListItem", "position": {{ forloop.counter }}, "url": "https://technofatty.com/blog/{{ post.slug }}/"}{% if not forloop.last %},{% endif %}{% endfor %}
      ]
    }
  ]
}
  {% endjsonld %}
{% endblock %}

{% block content %}
  <section class="section section--scaffold" role="region" aria-labelledby="{{ page_id }}-heading">
    <div class="wrap">
      <div class="scaffold__header">
        <h1 id="{{ page_id }}-heading">{{ page_title }}</h1>
        <a class="rss-link" href="{% url 'blog_rss' %}">RSS</a>
      </div>
      <div class="scaffold__body">
          {% include "coresite/partials/global/status_placeholder.html" %}
          <p>Latest news and insights from Technofatty.</p>
          <div class="blog-layout">
            <div class="blog-layout__main">
              {% if featured_post %}
              <article class="card featured-post">
                <h2 class="card__title"><a class="card__link" href="{% url 'blog_post' featured_post.slug %}">{{ featured_post.title }}</a></h2>
                <p class="post-meta">
                  <time datetime="{{ featured_post.date|date:'Y-m-d' }}">{{ featured_post.date|date:'d M Y' }}</time> ·
                  <a href="{% url 'blog_category' featured_post.category.slug %}">{{ featured_post.category.title }}</a>
                </p>
                <p class="post-excerpt">{{ featured_post.excerpt }}</p>
                <p><a class="card__link" href="{% url 'blog_post' featured_post.slug %}">Read more →</a></p>
              </article>
              {% endif %}
              <div class="post-grid">
                {% for post in posts %}
                <article class="card post-card">
                  <h2 class="card__title"><a class="card__link" href="{% url 'blog_post' post.slug %}">{{ post.title }}</a></h2>
                  <p class="post-meta">
                    <time datetime="{{ post.date|date:'Y-m-d' }}">{{ post.date|date:'d M Y' }}</time> ·
                    <a href="{% url 'blog_category' post.category.slug %}">{{ post.category.title }}</a>
                  </p>
                  <p class="post-excerpt">{{ post.excerpt }}</p>
                  <p><a class="card__link" href="{% url 'blog_post' post.slug %}">Read more →</a></p>
                </article>
                {% endfor %}
              </div>
            </div>
            <aside class="topics" role="region" aria-labelledby="topics-heading">
              <h2 id="topics-heading">Topics</h2>
              <ul class="topics__list">
                {% for category in categories %}
                <li class="topics__item"><a href="{% url 'blog_category' category.slug %}">{{ category.title }}</a></li>
                {% endfor %}
                {% for tag in tags %}
                <li class="topics__item"><a href="{% url 'blog_tag' tag.slug %}">#{{ tag.title }}</a></li>
                {% endfor %}
              </ul>
            </aside>
          </div>
          <p>Looking for more? Explore our Knowledge and Resources sections.</p>
          <nav class="pager" aria-label="Pagination">
            {% if prev_page_url %}<a class="pager__prev" href="{{ prev_page_url }}">Newer posts</a>{% endif %}
            <span class="pager__current">Page {{ page_number }} of {{ total_pages }}</span>
            {% if next_page_url %}<a class="pager__next" href="{{ next_page_url }}">Older posts</a>{% endif %}
          </nav>
          {% include "coresite/partials/newsletter_signup.html" %}
        </div>
      </div>
    </section>
  {% endblock %}

